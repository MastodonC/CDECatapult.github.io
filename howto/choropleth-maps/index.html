---
layout: howto
howto: true
title: How To's - Open Health Data Platform
page_title: How To's
icon: circle-lightbulb.png
---
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<script src="http://dimplejs.org/dist/dimple.v1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>

<!-- leaflet -->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

<script src="mapProcessing.js"></script>

<link href="styles.css" rel="stylesheet" type="text/css">
<script src="diabetes-per-head-per-ccg-per-month.js"></script>

<div class="how-to">
  <div class="container">
    <div class="title clearfix">
      <img src="/assets/images/{{ page.icon }}" class="icon" alt="">
      
      <!-- The title of the site section "How To's", you shouldn't change this. -->
      <h1>{{ page.page_title }}</h1>
    </div>
    
    <!-- The title of your How To -->
    <h2>Choropleth Maps</h2>
    
    <div class="row intro-text">
      <div class="col-sm-12 intro-column bold-intro-text">
        <p>
          Pellentesque habitant morbi tristique senectus et netus
          et malesuada fames ac turpis egestas. Etiam placerat
          risus mattis, suscipit tortor eu, pulvinar metus.
          Cras vehicula gravida urna, vel sollicitudin risus
          cursus vel. Proin congue, metus a hendrerit suscipit.
        </p>
      </div>
    </div>
  </div>
  
  <div class="tutorial">
    <div class="container">
      <div class="row howto-top">
        <div class="col-sm-6">
          <!-- The title to the tutorial section of the page, don't change this. -->
          <h2>Tutorial</h2>

          <!-- The title your guide -->
          <h3>Choropleth Maps</h3>
        </div>
        
        <div class="col-sm-6">
          <!-- The misc links. Add in hrefs and delete unneeded <li>s. -->
          <ul class="howto-links row">
            <li class="col-sm-6 gethelp">
              <a href="#">Get help</a>
            </li>
            
            <li class="col-sm-6 tutorial-files">
              <a href="#">Download tutorial files (.zip)</a>
            </li>
            
            <li class="col-sm-6 live-example">
              <a href="#">See live example</a>
            </li>
            
            <li class="col-sm-6 github">
              <a href="#">Get the files on Github</a>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="step">
        <div class="step-circle">1</div>
        
        <div class="row step-content">
          <div class="col-sm-6">
          </div><!-- /.col-sm-6 -->
          
          <div class="col-sm-6">
            <!-- Step right column content. -->
            <h4>Step one - Introduction</h4>
            
            <p>
              Nulla facilisi. Sed commodo ultrices erat, ac
              imperdiet mauris tincidunt a. Sed in tellus id
              est accumsan egestas. Duis a purus ac turpis
              vehicula sollicitudin. Duis ac dolor a dui porta
              faucibus. Interdum et malesuada fames ac ante
              ipsum primis in faucibus.
            </p>
            
            <p>
              Nullam sed aliquam nisl. Sed placerat euismod mi
              sed blandit. Suspendisse id ipsum vitae est cursus
              pharetra. Sed velit ligula, hendrerit ac leo quis,
              ultricies sodales est. Phasellus sed metus
              pellentesque nisi fermentum ullamcorper. Cras
              vitae malesuada libero. Nulla dictum malesuada
              consequat.
            </p>
          </div><!-- /.col-sm-6 -->
        </div><!-- /.row.step-content -->
      </div><!-- /.step -->
      
      <div class="step">
        <div class="step-circle">2</div>
        
        <div class="row step-content">
          <div class="col-sm-6">

            <!-- Step left column example content. -->
            <h4>Step two - Setting up the HTML</h4>
            
            <p>
              To build a choropleth map with D3 and Leaflet, you need 
              to include a number of Javascript libraries. In the
              code snippet on the right, we include them and set up
              an empty div where the choropleth map will be rendered to.
            </p>
          </div>
          
          <div class="col-sm-6">
            {% highlight html %}
<!doctype html>
<html>
  <head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="mapProcessing.js"></script>
    <script src="diabetes-per-head-per-ccg-per-month.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <link href="styles.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div id="choroplethmap"></div>
  </body>
</html>
            {% endhighlight %}
          </div><!-- /.col-sm-6 -->
        </div><!-- /.row.step-content -->
      </div><!-- /.step -->
      
      <div class="step">
        <div class="step-circle">3</div>
        
        <div class="row step-content">
          <div class="col-sm-6">
            <h4>Step three - Creating the choropleth map</h4>
            
            <p>
              The Javascript on the right will, once called, render the
              choropleth map into the div we created earlier.
            </p>
            
            <p>
              We call the function like this:
            </p>
            
            <div class="small-snippet">
              {% highlight javascript %}diabetes_per_head_per_ccg_per_month('choroplethmap');{% endhighlight %}
            </div>
          </div>
          
          <div class="col-sm-6">
            {% highlight javascript %}
var diabetes_per_head_per_ccg_per_month = function(div) {
  var map = L.map(div).setView([53.0, -1.5], 6);
  
  var color = function(d) {
    return  d == 'NA' ? '#333' :
            d == 'undefined' ? '#333' :
            d > 30 ? '#0C2C84' :
            d > 28 ? '#225EA8' :
            d > 26 ? '#1D91C0' :
            d > 24 ? '#41B6C4' :
            d > 22 ? '#7FCDBB' :
            d > 20 ? '#C7E9B4' :
            '#FFFFCC';
  };
  
  var style = function(feature) {
    return {
      fillColor: color(feature.properties.per_capita_spend),
      weight: 2,
      opacity: 0.5,
      color: 'white',
      dashArray: '3',
      fillOpacity: 0.8
    }
  };
  
  var defaultStyle = function(feature) {
    return {
      outlineColor: "#000000",
      outlineWidth: 0.5,
      weight: 1,
      opacity: 1,
      fillOpacity: 0
    };
  };
  
  L.tileLayer('http://{s}.tile.cloudmade.com/{key}/22677/256/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2012 CloudMade',
    key: 'BC9A493B41014CAABB98F0471D759707'
  }).addTo(map);
  
  mergedFeatureLayer(map, "data/diabetes_per_head_per_ccg_per_month.csv", "data/ccg-boundaries.json", "ccg_code", style, null, null, "ccg_boundaries");
  
  addLegend([0, 20, 22, 24, 26, 28, 30, 34], map, color);
}
            {% endhighlight %}
          </div><!-- /.col-sm-6 -->
        </div><!-- /.row.step-content -->
      </div><!-- /.step -->
      
      <div class="step">
        <div class="step-circle">4</div>
        
        <div class="row step-content">
          <div class="col-sm-6">
            <h4>Step four - Styling the map</h4>
            
            <p>
              When choosing the colours for your choropleth map, it's important
              to make sure you don't pick colours that are too close together -
              and therefore hard to distinguish - or too many colours, which
              the viewer may find overwhelming.
            </p>
            
            <p>
              It's also important to pay attention to how
              strong the colours you use are. A darker
              colour is likely to be viewed by the user
              as a higher value, so, for example, displaying
              low population density with a dark grey might
              be confusing.
            </p>
            
            <p>
              Finally, it's important that your choropleth map
              is accessible. Make sure that you don't pick colours
              that could be misinterpreted by colour-blind viewers.
            </p>
            
            <p>
              Colour can greatly enhance the communication between
              the cartographer and their audience but poor colour
              choice can result in a map that is neither effective
              nor appealing to the map user; sometimes simpler
              is better.
            </p>
            
            <p>
              The colour choices in the example above can be altered
              in the <em>color()</em> function. 
            </p>
          </div>
          
          <div class="col-sm-6">
            <div id="spendmap" class="spendmap"></div>
            
            <script>
              diabetes_per_head_per_ccg_per_month('spendmap');
            </script>
          </div><!-- /.col-sm-6 -->
        </div><!-- /.row.step-content -->
      </div><!-- /.step -->
      
      {% include howto-collaborate.html %}
    </div><!-- /.container -->
  </div><!-- /.tutorial -->
</div><!-- /.how-to -->
